#!/bin/bash
set -euo pipefail

cd "$(dirname "$0")/.."

echo "-------------------- ðŸ§¹ Cleaning up LocalStack Environment --------------------"

# Stop and remove all containers
echo "Stopping LocalStack services..."
docker-compose -f deploy/docker-compose.localstack.yml down -v

# Clean up Terraform state
echo "Cleaning up Terraform state..."
cd terraform
terraform destroy -auto-approve || true
rm -f terraform.tfstate* .terraform.lock.hcl
rm -rf .terraform/

# Clean up Docker images
echo "Cleaning up Docker images..."
docker rmi ani-backend:latest ani-frontend:latest || true
docker rmi localhost:4566/ani-backend:latest localhost:4566/ani-frontend:latest || true

# Clean up LocalStack data
echo "Cleaning up LocalStack data..."
cd ..
rm -rf localstack-data/

echo "âœ… LocalStack environment cleaned up!"
